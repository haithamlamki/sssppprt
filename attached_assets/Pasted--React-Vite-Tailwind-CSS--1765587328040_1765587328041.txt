إعداد المشروع والأدوات
سنستخدم React (مع Vite) لبناء الواجهة الأمامية، وTailwind CSS للتصميم السريع والمتجاوب، وSupabase لإدارة المصادقة وقاعدة البيانات (PostgreSQL) والتخزين السحابي. ننشئ مشروع React جديد ثم نثبت مكتبة Supabase ونضبط متغيرات البيئة (.env.local) للمفتاح وعنوان المشروع
supabase.com
. في ملف src/supabaseClient.js نقوم بتهيئة عميل Supabase كما يلي:
// src/supabaseClient.js
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseKey = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY
export const supabase = createClient(supabaseUrl, supabaseKey)
الوظائف الأساسية التي سنغطيها تشمل:
تسجيل الدخول/التسجيل: باستخدام Supabase Auth (بريد إلكتروني وكلمة مرور)
supabase.com
supabase.com
.
إدارة اللاعبين: إنشاء/تعديل/حذف لاعب بحقول (الاسم، رقم القميص، المركز، الصورة، الفريق) عبر استدعاءات Supabase DB (مثلاً supabase.from('players').insert(...))
supabase.com
supabase.com
.
إدارة الفرق: إضافة فريق، رفع شعار عبر Supabase Storage (supabase.storage.from('logos').upload(...))
supabase.com
، وتعيين لاعبين لهذا الفريق.
إنشاء بطولة: إدخال بيانات البطولة (الاسم، عدد الفرق، نوع البطولة) في جدول tournaments باستخدام supabase.from('tournaments').insert(...)
supabase.com
.
صفحة التشكيلات: واجهة سحب وإفلات لترتيب لاعبين على الملعب، باستخدام مكتبة مثل React DnD
v0.app
.
لوحة تحكم إدارية: عرض إحصائيات (عدد اللاعبين، الفرق، البطولات) وجداول أو نتائج، من خلال استعلامات بسيطة على قاعدة البيانات.
هذه الميزات تسمح بتوسيع التطبيق لاحقاً بإضافة بث مباشر، تصويت، تسجيل حكام، تحليلات أداء، أو دعم رياضات أخرى بسهولة.
التهيئة وإنشاء تطبيق React
للبدء ننفذ:
npm create vite@latest sports-app -- --template react
cd sports-app
npm install @supabase/supabase-js react-router-dom react-dnd zustand
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
ثم نُدخل عنوان المشروع (VITE_SUPABASE_URL) ومفتاح النشر (VITE_SUPABASE_PUBLISHABLE_KEY) في .env.local. نفعّل Tailwind بإضافة الإعدادات في tailwind.config.js وindex.css بناءً على توثيق Tailwind لتصميم سريع وموحد
v2.tailwindcss.com
. مثلاً:
/* src/index.css */
@tailwind base;
@tailwind components;
@tailwind utilities;
هيكل المشروع المقترح
src/supabaseClient.js – تهيئة عميل Supabase (كما أعلاه)
src/contexts/AuthContext.jsx – سياق React لمشاركة حالة المستخدم المصادق عليه
src/components/Navbar.jsx – شريط تنقل عام (روابط إلى الصفحات)
src/pages/Login.jsx – صفحة تسجيل الدخول/التسجيل
src/pages/Players.jsx – صفحة إدارة اللاعبين (قائمة ونموذج CRUD)
src/pages/Teams.jsx – صفحة إدارة الفرق (إضافة فريق، رفع شعار)
src/pages/Tournaments.jsx – صفحة إنشاء بطولة (نموذج بيانات)
src/pages/Formation.jsx – صفحة التشكيلة (سحب وإفلات اللاعبين على الملعب)
src/pages/Dashboard.jsx – لوحة تحكم إدارية (عرض إحصائيات)
src/App.jsx – نقطة الدخول للتوجيه (React Router) وربط الصفحات
هذا الفصل الواضح يسهل إضافة ميزات مستقبلية أو صيانة الكود لاحقاً.
المصادقة (تسجيل الدخول/التسجيل)
سنستخدم Supabase Auth لتسجيل الحسابات وتسجيل الدخول. في سياق React (Context) نشترك في مراقبة الحالة الجارية للمصادقة. مثال مبسط:
// src/contexts/AuthContext.jsx
import { createContext, useState, useEffect } from 'react'
import { supabase } from '../supabaseClient'

export const AuthContext = createContext()

export function AuthProvider({ children }) {
  const [session, setSession] = useState(null)

  useEffect(() => {
    supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session)
    })
    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
      setSession(session)
    })
    return () => subscription.unsubscribe()
  }, [])

  const signup = async (email, password) => {
    const { data, error } = await supabase.auth.signUp({ email, password })
    if (error) throw error
    // يمكن حفظ بيانات إضافية للمستخدم في الجدول مثلاً
  }

  const login = async (email, password) => {
    const { user, session, error } = await supabase.auth.signIn({ email, password })
    if (error) throw error
    setSession(session)
  }

  const logout = async () => {
    await supabase.auth.signOut()
    setSession(null)
  }

  return (
    <AuthContext.Provider value={{ session, signup, login, logout }}>
      {children}
    </AuthContext.Provider>
  )
}
بهذه الطريقة نستخدم supabase.auth.signUp للتسجيل، وsupabase.auth.signIn للدخول
supabase.com
supabase.com
. يمكنك استدعاء signup(email, password) عند الضغط على زر التسجيل، وlogin(email, password) للزر دخول. على سبيل المثال، في مكون تسجيل دخول بسيط:
// src/pages/Login.jsx
import { useContext, useState } from 'react'
import { AuthContext } from '../contexts/AuthContext'

export default function Login() {
  const { login, signup } = useContext(AuthContext)
  const [email, setEmail] = useState(''), [password, setPassword] = useState('')
  const [isNew, setIsNew] = useState(false)

  const handleSubmit = async (e) => {
    e.preventDefault()
    try {
      if (isNew) await signup(email, password)
      else await login(email, password)
      alert('نجحت العملية!')
    } catch (error) {
      alert('خطأ: ' + error.message)
    }
  }

  return (
    <div className="max-w-md mx-auto mt-10 p-4 shadow">
      <h2 className="text-xl font-bold mb-4">{isNew ? 'إنشاء حساب' : 'تسجيل دخول'}</h2>
      <form onSubmit={handleSubmit} className="flex flex-col space-y-4">
        <input type="email" placeholder="البريد الإلكتروني" value={email}
               onChange={e => setEmail(e.target.value)} required
               className="px-3 py-2 border rounded" />
        <input type="password" placeholder="كلمة المرور" value={password}
               onChange={e => setPassword(e.target.value)} required
               className="px-3 py-2 border rounded" />
        <button type="submit" className="bg-blue-600 text-white py-2 rounded">
          {isNew ? 'سجل الآن' : 'دخول'}
        </button>
      </form>
      <button onClick={() => setIsNew(!isNew)} className="mt-2 text-blue-500">
        {isNew ? 'لديك حساب؟ تسجيل دخول' : 'إنشاء حساب جديد'}
      </button>
    </div>
  )
}
التنقل وبنية التطبيق (React Router)
سنستخدم React Router للانتقال بين الصفحات. في App.jsx نغلف التطبيق بـ <BrowserRouter> ونحدد المسارات (Routes). مثلاً:
// src/App.jsx
import { BrowserRouter, Routes, Route } from 'react-router-dom'
import { AuthProvider } from './contexts/AuthContext'
import Navbar from './components/Navbar'
import Dashboard from './pages/Dashboard'
import Players from './pages/Players'
import Teams from './pages/Teams'
import Tournaments from './pages/Tournaments'
import Formation from './pages/Formation'
import Login from './pages/Login'

function App() {
  return (
    <AuthProvider>
      <BrowserRouter>
        <Navbar />
        <div className="container mx-auto p-4">
          <Routes>
            <Route path="/" element={<Dashboard />} />
            <Route path="/players" element={<Players />} />
            <Route path="/teams" element={<Teams />} />
            <Route path="/tournaments" element={<Tournaments />} />
            <Route path="/formation" element={<Formation />} />
            <Route path="/login" element={<Login />} />
          </Routes>
        </div>
      </BrowserRouter>
    </AuthProvider>
  )
}

export default App
في شريط التنقل (Navbar.jsx) نستخدم <NavLink> أو <Link> من React Router لربط الصفحات
reactrouter.com
. مثلاً:
// src/components/Navbar.jsx
import { NavLink } from 'react-router-dom'
export default function Navbar() {
  return (
    <nav className="bg-gray-800 p-4">
      <NavLink to="/" className="text-white mr-4">لوحة التحكم</NavLink>
      <NavLink to="/players" className="text-white mr-4">اللاعبون</NavLink>
      <NavLink to="/teams" className="text-white mr-4">الفرق</NavLink>
      <NavLink to="/tournaments" className="text-white mr-4">البطولات</NavLink>
      <NavLink to="/formation" className="text-white">التشكيلة</NavLink>
    </nav>
  )
}
إدارة اللاعبين (صفحة Players)
في هذه الصفحة نظهر قائمة اللاعبين ونوفر نموذجًا لإضافة/تعديل لاعب. عند التحميل الأولي نجلب بيانات اللاعبين من جدول players في Supabase ونخزنها في حالة (state). مثال على تحميل البيانات:
useEffect(() => {
  const fetchPlayers = async () => {
    const { data, error } = await supabase.from('players').select('*')
    if (error) console.error(error)
    else setPlayers(data)
  }
  fetchPlayers()
}, [])
عند إضافة لاعب جديد، نستدعي: supabase.from('players').insert({ name, number, position, team_id, image_url })
supabase.com
، وحين تعديل أو حذف مستخدم نفس الطريقة مع .update() أو .delete(). مثال توضيحي على إضافة لاعب:
// ضمن Players.jsx
const addPlayer = async (player) => {
  const { data, error } = await supabase
    .from('players')
    .insert(player)
    .select()
  if (error) console.error(error)
  else setPlayers([...players, data[0]])
}
وفي النموذج نستخدم عناصر إدخال (inputs) لمعالجة الحقول، مع فصل كود تحميل الصورة (في حال كان هناك رفع صورة). عند تحديث، نستدعي:
const updatePlayer = async (id, updates) => {
  const { data, error } = await supabase
    .from('players')
    .update(updates)
    .eq('id', id)
    .select()
  if (error) console.error(error)
  else setPlayers(players.map(p => p.id === id ? data[0] : p))
}
وأخيراً، للحذف:
const deletePlayer = async (id) => {
  await supabase.from('players').delete().eq('id', id)  // لا حاجة لعرض البيانات المحذوفة
  setPlayers(players.filter(p => p.id !== id))
}
بهذه الطرق نقوم بعمليات CRUD على اللاعبين بالكامل باستخدام Supabase
supabase.com
supabase.com
supabase.com
. تصميم الجدول والنموذج يتم عبر Tailwind لضمان مظهر متجاوب.
إدارة الفرق (صفحة Teams)
بالمثل، صفحة الفرق تسمح بإضافة فريق جديد برفع شعار (صورة). نفترض وجود جدول teams به أعمدة مثل { id, name, logo_url }. عند الضغط لإضافة فريق، نستقبل بيانات النموذج بما في ذلك ملف الصورة. أولاً نرفع الصورة إلى Storage:
const addTeam = async ({ name, logoFile }) => {
  // رفع الشعار إلى حاوية 'logos'
  const { data: uploadData, error: uploadError } = await supabase
    .storage.from('logos')
    .upload(`logos/${logoFile.name}`, logoFile)
  if (uploadError) {
    console.error(uploadError)
    return
  }
  // الحصول على رابط قابل للوصول للصورة
  const { publicURL } = supabase
    .storage.from('logos')
    .getPublicUrl(`logos/${logoFile.name}`)
  // إدخال بيانات الفريق في قاعدة البيانات
  const { data, error } = await supabase
    .from('teams')
    .insert({ name, logo_url: publicURL })
    .select()
  if (error) console.error(error)
  else setTeams([...teams, data[0]])
}
يرجى ملاحظة أن مثال الرفع أعلاه يتبع طريقة التحميل القياسية في Supabase Storage
supabase.com
. بعد رفع الملف، نأخذ الـ publicURL لإضافته إلى سجل الفريق. العرض في الواجهة يُظهر شعار الفريق مثلاً باستخدام <img src={team.logo_url} ... />. يمكننا أيضًا ربط اللاعبين بالفرق عبر حقل مثل team_id في جدول players (مثلاً قائمة اختيار أثناء إنشاء/تعديل اللاعب).
إنشاء بطولة (صفحة Tournaments)
ننشئ نموذجاً بسيطاً لإدخال اسم البطولة وعدد الفرق ونوعها (دور مجموعات أو خروج مغلوب). عند الإرسال ندعو:
const createTournament = async ({ name, teamCount, format }) => {
  const { data, error } = await supabase
    .from('tournaments')
    .insert({ name, team_count: teamCount, format })
    .select()
  if (error) console.error(error)
  else {
    setTournaments([...tournaments, data[0]])
    alert('تم إنشاء البطولة بنجاح')
  }
}
يمكن توسيع هذا النموذج لاحقاً لإضافة مراحل البطولة وجدولة المباريات، لكن في النواة نسجل بياناتها في قاعدة البيانات.
صفحة التشكيلات (Drag & Drop)
هذه الصفحة تتيح سحب اللاعبين ووضعهم في مواقع الملعب. مثال شائع هو استخدام مكتبة React DnD لإنشاء مناطق قابلة للإفلات (Drop targets) ومصادر سحب (Drag sources)
v0.app
. هيكل مبسط:
// src/pages/Formation.jsx
import { useState } from 'react'
import { useDrag, useDrop } from 'react-dnd'

function Player({ player, onDrop }) {
  const [, drag] = useDrag(() => ({
    type: 'PLAYER',
    item: { player }
  }))
  return <div ref={drag} className="p-2 bg-gray-200">{player.name}</div>
}

function Position({ position, onDropPlayer }) {
  const [{ isOver }, drop] = useDrop(() => ({
    accept: 'PLAYER',
    drop: (item) => onDropPlayer(position, item.player),
    collect: monitor => ({ isOver: !!monitor.isOver() })
  }))
  return (
    <div ref={drop} className={`w-32 h-32 border ${isOver ? 'bg-green-100' : ''}`}>
      {position.player ? <span>{position.player.name}</span> : 'أقع هنا'}
    </div>
  )
}

export default function Formation() {
  const [availablePlayers, setAvailablePlayers] = useState(playersFromDB) // بيانات مثال
  const [positions, setPositions] = useState([
    { id: 1, name: 'حارس المرمى', player: null },
    { id: 2, name: 'مدافع', player: null },
    // باقي المراكز...
  ])

  const handleDrop = (position, player) => {
    // تحديث حالة التشكيلة عند سحب لاعب لمكانه
    setPositions(prev => prev.map(pos =>
      pos.id === position.id ? { ...pos, player } : pos
    ))
    setAvailablePlayers(prev => prev.filter(p => p.id !== player.id))
  }

  return (
    <div className="flex">
      <div className="w-1/3 space-y-2">
        {availablePlayers.map(p => <Player key={p.id} player={p} />)}
      </div>
      <div className="flex-1 grid grid-cols-3 gap-4">
        {positions.map(pos =>
          <Position key={pos.id} position={pos} onDropPlayer={handleDrop} />)}
      </div>
    </div>
  )
}
في هذا المثال البسيط، نستخدم useDrag على مكون اللاعب وuseDrop على مكون الموقع في الملعب، ونقوم بتحديث حالة التشكيلة عند إسقاط لاعب في موقع
v0.app
. التصميم هنا بسيط باستخدام Flex/Grid وTailwind لإعداد الملعب وعرض اللاعبين والقوائم. يمكن تطوير الرسوميات لتبدو كالملعب الحقيقي باستخدام خلفيات مناسبة (bg-green-600 للملعب كما في الطلب).
لوحة التحكم الإدارية (Dashboard)
ننشئ صفحة تعرض إحصائيات أساسية (عدد اللاعبين، الفرق، البطولات). على سبيل المثال، يمكننا جلب عدد السجلات في كل جدول بواسطة:
useEffect(() => {
  const fetchStats = async () => {
    const [{ count: pCount }, { count: tCount }, { count: tourCount }] = await Promise.all([
      supabase.from('players').select('*', { count: 'exact', head: true }),
      supabase.from('teams').select('*', { count: 'exact', head: true }),
      supabase.from('tournaments').select('*', { count: 'exact', head: true })
    ])
    setStats({ players: pCount, teams: tCount, tours: tourCount })
  }
  fetchStats()
}, [])
ثم نعرض هذه الأرقام بشكل بطاقات أو جداول. مثال عرض بسيط:
// src/pages/Dashboard.jsx
export default function Dashboard() {
  const [stats, setStats] = useState({ players: 0, teams: 0, tours: 0 })

  // (قم بتحميل الإحصائيات كما في المثال أعلاه)

  return (
    <div className="grid grid-cols-3 gap-4">
      <div className="p-4 bg-blue-100 rounded">
        <h3 className="text-2xl">{stats.players}</h3>
        <p>عدد اللاعبين</p>
      </div>
      <div className="p-4 bg-green-100 rounded">
        <h3 className="text-2xl">{stats.teams}</h3>
        <p>عدد الفرق</p>
      </div>
      <div className="p-4 bg-yellow-100 rounded">
        <h3 className="text-2xl">{stats.tours}</h3>
        <p>عدد البطولات</p>
      </div>
    </div>
  )
}
بهذه اللوحة نعطي نظرة عامة سريعة على البيانات الرئيسية في التطبيق. يمكن توسيعها لاحقاً بإضافة رسوم بيانية أو قوائم نتائج المباريات، لكن المبدأ هو استخدام Supabase لاستعلام البيانات وعرضها.
ملخص الهيكل والبحث المستقبلي
الآن حصلنا على هيكل منظم للملفات المصدريّة لتطبيقنا: فصل صفحات (pages) عن مكونات عامة (components) وسياق وحالة (contexts/services). نستخدم استدعاءات Supabase القياسية (CRUD) لإدارة اللاعبين والفرق والبطولات كما في الوثائق
supabase.com
supabase.com
، ونستخدم React Router للتنقل
reactrouter.com
، وTailwind CSS لإنشاء تصميم سريع ومتجاوب
v2.tailwindcss.com
. يمكن لهذا الأساس أن يستوعب إضافة ميزات جديدة (مثل بث مباشر أو تصويت أو تسجيل حكام) دون تغيير كبير في البنية.