شرح مختصر للمشكلة

أنت تغيّر مجموعة الفريق (أ/ب) من صفحة “الفرق المشاركة”، لكن قائمة المباريات القادمة لا تتغير لأن النظام يولّد المباريات مرة واحدة ويخزنها، ثم يعرض المباريات المخزّنة القديمة حتى لو تغيّر توزيع المجموعات بعد ذلك.
النتيجة: تظهر مباريات تتجاهل اختيار المجموعات (وقد تظهر مواجهات بين مجموعتين داخل مرحلة المجموعات).

“ (وصف مواصفات التوليد والعرض )
1) مصدر الحقيقة

توزيع المجموعات يؤخذ فقط من: الفرق المشاركة → حقل المجموعة (أ/ب).

أي تغيير في مجموعة فريق يعتبر “تغيير هيكل البطولة”.

2) توليد مباريات مرحلة المجموعات

البطولة تحتوي مجموعتين (أ، ب)، في كل مجموعة 4 فرق.

في مرحلة المجموعات:
ممنوع إنشاء مباراة بين فريقين من مجموعتين مختلفتين.

لكل مجموعة (4 فرق) يتم توليد 6 مباريات (دوري من دور واحد)، مجموع البطولة = 12 مباراة مجموعات.

يتم توزيع الجولات على الأيام يدويًا/حسب الإعدادات:

عدد الجولات للمجموعات = 3 جولات

كل جولة فيها مباراتين لكل مجموعة (إجمالي 4 مباريات/جولة للبطولة)

3) إعدادات “توليد جدول المباريات” المفروض تكون واضحة وتتحكم بالتوليد

تاريخ البداية / تاريخ النهاية

وقت بداية اليوم

عدد المباريات في اليوم

قاعدة توزيع:
“كل جولة = (مباراتين للمجموعة أ + مباراتين للمجموعة ب)”

خيار مهم: إعادة توليد عند تغيير المجموعات (انظر الحل)

4) ما الذي يحدث بعد التوليد (التعديل بعد التوليد)

بعد توليد المباريات: يسمح بـ

تعديل التاريخ/الوقت/الملعب/الحكم

لكن تغيير المجموعات بعد التوليد يجب أن يفعّل سياسة واضحة:

إمّا “إعادة توليد تلقائي”

أو “إظهار تحذير: التغيير لن ينعكس إلا بعد إعادة التوليد”

أو “عمل نسخة جديدة من الجدول” (الأفضل)

5) عرض المباريات القادمة (المطلوب)

عند عرض “مباريات مرحلة المجموعات”:

يعرض فقط مباريات المرحلة = “مجموعات”

ويعرض بجانب كل مباراة وسم المجموعة (أ/ب)

ويتحقق دائمًا: الفريقين نفس المجموعة، وإلا تُعلَّم المباراة “غير صالحة” ولا تُعرض للمستخدم كجدول صحيح

6) خروج المغلوب (بعد اكتمال المجموعات)

يتم توليد خروج المغلوب فقط بعد تحديد المتأهلين:

نصف نهائي: A1 vs B2 و B1 vs A2

النهائي: الفائزان

إذا غير مكتمل (TBD): يعرض “فائز مباراة X” بدل فريق.

الحل بدون كود (عملي وواضح)
الحل 1 (الأبسط والأضمن)

عند تغيير مجموعة أي فريق بعد التوليد:

ضع حالة: “الجدول بحاجة لإعادة توليد”

لا تحاول “تحديث جزئي”

زر واحد: إعادة توليد مباريات المجموعات (ويمسح مباريات المجموعات غير المنتهية ويولّد من جديد حسب المجموعات الحالية)

مع رسالة واضحة للمستخدم:
“تم تغيير المجموعات، جدول المباريات الحالي قد لا يعكس التوزيع الجديد. اضغط إعادة التوليد.”

الحل 2 (أكثر احترافية)

إنشاء “نسخة جدول” جديدة عند إعادة التوليد:

جدول v1 (قديم)

جدول v2 (جديد)

العرض دائمًا يُظهر آخر نسخة نشطة فقط
(يمنع التضارب ويحافظ على تاريخ التعديلات)

حل سريع للتحقق (لمنع الأخطاء فورًا)

في العرض: إذا كانت مباراة مجموعات بين مجموعتين مختلفتين → تظهر كتعارض (⚠️) وتُمنع من اعتماد “اكتمال مرحلة المجموعات”.